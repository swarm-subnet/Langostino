================================================================================
                    SWARM ROS PROJECT - ABSOLUTE FILE PATHS
================================================================================

PROJECT ROOT
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros


CORE CONFIGURATION
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/config/swarm_params.yaml
  └─ All ROS parameters for all nodes (centralized configuration)
     - Node parameters with ros__parameters sections
     - Safety thresholds, PID gains, hardware settings
     - I2C addresses, serial ports, rates


LAUNCH FILES & SCRIPTS
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/launch/swarm_ai_launch.py
  └─ ROS 2 Python launch file
     - Node startup orchestration
     - Parameter loading and argument substitution
     - Topic remappings

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/scripts/ai_flight_node_wrapper.sh
  └─ Python virtual environment wrapper
     - Activates venv before running ai_flight_node.py
     - Ensures isolation of model dependencies


MAIN ROS NODES
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/ai_adapter_node.py
  └─ AI Adapter Node (Observation Generation)
     - Sensor fusion (GPS, IMU, LiDAR, attitude)
     - Geodetic to ENU conversion
     - 131-D observation assembly
     - Waypoint processing
     - Rate: 30 Hz

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/ai_flight_node.py
  └─ AI Flight Node (PPO Inference)
     - Model loading (weights_only=True)
     - Policy forward pass (deterministic)
     - Action generation [vx, vy, vz, speed]
     - Rate: 10 Hz

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/fc_comms_node.py
  └─ FC Communications Node (MSP Protocol)
     - Serial communication with INAV 7
     - MSP message parsing and publishing
     - Waypoint polling
     - Telemetry request routing
     - Rate: 10 Hz (telemetry), 1 Hz (heartbeat)

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/fc_adapter_node.py
  └─ FC Adapter Node (Velocity Control)
     - Reads AI actions [vx, vy, vz]
     - PID velocity control loop
     - RC command generation
     - Direct MSP_SET_RAW_RC serial output
     - Pre-arm sequence handling
     - Rate: 40 Hz

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/safety_monitor_node.py
  └─ Safety Monitor Node (Failsafe & RTH)
     - Safety violation detection
     - Altitude, velocity, battery, geofence checks
     - Return-to-home activation
     - Home position tracking
     - Rate: 10 Hz (monitor), 1 Hz (status)

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/lidar_reader_node.py
  └─ LiDAR Reader Node (I2C Sensor Interface)
     - I2C communication with VL53L0X sensors
     - Distance measurement and filtering
     - Status monitoring
     - Rate: 100 Hz max

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/black_box_recorder_node.py
  └─ Black Box Recorder Node (Flight Logging)
     - Records observations, actions, telemetry
     - Buffered writes to log files
     - File rotation and compression
     - Statistics tracking


UTILITY MODULES
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/utils/coordinate_transforms.py
  └─ Coordinate Transformation Utilities
     - geodetic_to_enu() - GPS to local ENU
     - enu_to_geodetic() - Inverse transformation
     - compute_origin_for_initial_position() - HOME at [0,0,3]
     - distance_2d/3d() - Euclidean distance
     - bearing_to_target() - Navigation bearing
     - velocity_cog_to_enu() - GPS velocity conversion

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/utils/sensor_data_manager.py
  └─ Sensor Data Manager
     - Centralized sensor data storage
     - GPS quality tracking and averaging
     - Origin computation and validation
     - Data received flags tracking

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/utils/observation_builder.py
  └─ Observation Builder
     - 131-D observation assembly
     - Action buffer management (25 past actions)
     - Goal vector computation and normalization
     - LiDAR distance normalization

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/utils/msp_serial_handler.py
  └─ MSP Serial Handler
     - Threaded serial I/O
     - Message queue management
     - Auto-reconnection logic
     - Timeout handling

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/utils/msp_message_parser.py
  └─ MSP Message Parser
     - MSP data frame parsing
     - IMU, GPS, attitude, status conversion
     - Battery and motor data extraction
     - Waypoint data parsing

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/utils/telemetry_publisher.py
  └─ Telemetry Publisher
     - ROS topic publishing
     - Message creation and publication
     - Connection status reporting


PROTOCOL & CONTROL MODULES
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/msp_protocol.py
  └─ MSP Protocol Definitions
     - MSPCommand enum (100+ commands)
     - MSPDirection enum (REQUEST/RESPONSE)
     - MSPMessage class
     - MSPDataTypes for packing/unpacking

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/pid_controller.py
  └─ PID Controller
     - VelocityPIDController class
     - Separate XY (roll/pitch) and Z (throttle) control
     - Integral clamping and filtering
     - Rate limiting


DOCUMENTATION
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/README.md
  └─ Main project README
     - Project overview
     - Architecture description
     - Node documentation (7 nodes)
     - Topic listing
     - Parameter reference

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/PARAMETER_CONFIGURATION.md
  └─ Detailed parameter documentation
     - All ROS parameters explained
     - Default values and ranges
     - Tuning guidelines

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/EXPLORATION_REPORT.md
  └─ Comprehensive exploration report
     - Project structure (this document)
     - Node purposes and responsibilities
     - Waypoint management flow
     - Coordinate transformation system
     - ROS topic architecture
     - RTH and safety logic
     - Known issues and fixes

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/ARCHITECTURE_VISUAL.txt
  └─ ASCII architecture diagrams
     - Data flow visualization
     - Observation vector specification
     - Coordinate system diagram
     - Waypoint tracking flow
     - Safety monitor flow
     - Parameter reference


FLIGHT LOGS & ANALYSIS
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/flight-logs/
  └─ Flight data directory
     
     COORDINATE_FRAME_BUG_AND_FIX.md
     └─ Critical issue documentation
        - ENU vs body frame mismatch analysis
        - Flight test results
        - Proposed fix (ENU to body transformation)
        - Verification test plan
     
     FLIGHT_ANALYSIS_REPORT.md
     └─ Flight analysis results
        - Test methodology
        - Observed behavior
        - Data interpretation
        - Lessons learned
     
     GPS_IMPROVEMENTS.md / GPS_QUICK_START.md
     └─ GPS configuration and optimization
     
     CODE_IMPROVEMENTS_SUMMARY.md
     └─ Code refactoring changes
     
     FIXES_APPLIED.md
     └─ Bug fixes and improvements applied
     
     README_BlackBox.md
     └─ Black box recorder documentation


TESTING & LEGACY CODE
================================================================================
/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/tests/
  └─ Test and utility scripts
     - arm_only_simple.py
     - msp_arm_drone.py
     - msp_arm_and_throttle_*.py
     - msp_override_verify.py

/Users/rafaeltorrecilla/Documents/swarm/swarm-ros/src/swarm_ai_integration/swarm_ai_integration/old/
  └─ Legacy node implementations
     - fc_adapter_node.py (old versions)
     - ai_adapter_node.py (old versions)
     - Archived for reference


SYSTEM DEPENDENCIES & EXECUTION
================================================================================
Python Virtual Environment:
  Location: ~/ai_flight_node_env (referenced in ai_flight_node_wrapper.sh)
  Purpose: Isolate PyTorch, Stable-Baselines3 dependencies
  
ROS 2 Installation:
  Target: Raspberry Pi / Ubuntu 22.04 (Humble)
  Setup: Install ROS 2, build package with colcon
  
Hardware Serial Port:
  Primary: /dev/ttyAMA0 (UART on Raspberry Pi)
  Baud Rate: 115200
  Used for: INAV 7 MSP communication

I2C Bus:
  Primary: /dev/i2c-1
  Devices: VL53L0X LiDAR sensors (0x08, potentially 0x09)
  Rate: 100 Hz max per sensor


KEY EXECUTION FLOW
================================================================================

1. STARTUP:
   ros2 launch swarm_ai_integration swarm_ai_launch.py \
     model_path:=/home/pi/swarm-ros/model/UID_203.zip \
     enable_safety:=true
   
   └─ Loads swarm_params.yaml
   └─ Starts all nodes in order
   └─ Establishes serial connection to INAV
   └─ Begins sensor polling

2. OBSERVATION GENERATION:
   AI Adapter (30 Hz) waits for GPS lock
   └─ Averages 10-30 GPS samples (tiered by HDOP)
   └─ Computes origin such that current position → [0, 0, 3]
   └─ Converts all coordinates to ENU
   └─ Builds 131-D observation
   └─ Publishes /ai/observation

3. AI INFERENCE:
   AI Flight Node (10 Hz) receives observation
   └─ Forward pass through PPO policy
   └─ Generates 4-D action [vx, vy, vz, speed]
   └─ Publishes /ai/action

4. VELOCITY CONTROL:
   FC Adapter (40 Hz) receives action
   └─ Pre-arm sequence (first 30 seconds)
   └─ Warm-up phase (first 40 frames)
   └─ Main loop: PID(velocity_error) → RC channels
   └─ Direct MSP_SET_RAW_RC via serial

5. SAFETY MONITORING:
   Safety Monitor (10 Hz) monitors state
   └─ Checks 7 violation types
   └─ Activates hover override or RTH as needed
   └─ RTH sets CH9=1800 for INAV recognition

6. HARDWARE CONTROL:
   INAV 7 Flight Controller
   └─ Interprets RC channels
   └─ Executes attitude control
   └─ Reads sensors (IMU, GPS, battery)
   └─ Loops telemetry back to /fc/*


CRITICAL PARAMETER LOCATIONS
================================================================================

In swarm_params.yaml, search for:

  relative_start_enu: [0.0, 0.0, 3.0]
    └─ Initial drone position (0, 0, 3m altitude)

  max_ray_distance: 20.0
    └─ LiDAR normalization distance (MUST match training)

  kp_xy: 150.0, ki_xy: 10.0, kd_xy: 20.0
    └─ XY velocity PID gains (roll/pitch control)

  kp_z: 100.0, ki_z: 5.0, kd_z: 15.0
    └─ Z velocity PID gains (throttle control)

  max_altitude: 10.0
  max_distance_from_home: 100.0
  min_battery_voltage: 14.0
    └─ Safety thresholds


KNOWN ISSUES LOCATION
================================================================================

ENU vs Body Frame Bug:
  File: flight-logs/COORDINATE_FRAME_BUG_AND_FIX.md
  Affects: fc_adapter_node.py lines 233-246
  Fix: Add ENU-to-body transformation before PID
  Status: Documented, ready to apply
  Severity: Moderate (affects rotation scenarios)


================================================================================
                          END OF PATHS REFERENCE
================================================================================
