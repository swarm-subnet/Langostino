# Swarm AI Integration Parameters Configuration
# Complete parameter set for all nodes in the swarm system

# ═══════════════════════════════════════════════════════════════════
# AI Adapter Node Parameters
# ═══════════════════════════════════════════════════════════════════
ai_adapter_node:
  ros__parameters:
    # Observation generation
    telemetry_rate: 30.0                # Observation generation rate (Hz)
    max_ray_distance: 20.0              # Maximum distance for normalization (meters) - MUST MATCH TRAINING
    action_buffer_size: 25              # Number of past actions to buffer

    # Initial position
    relative_start_enu: [0.0, 0.0, 3.0] # Initial relative position [East, North, Up] (meters)

    # GPS settings
    min_gps_satellites: 5                # Minimum GPS satellites for valid fix

    # QoS settings
    sensor_qos_depth: 1                 # QoS depth for sensor topics
    reliable_qos_depth: 10              # QoS depth for reliable topics

# ═══════════════════════════════════════════════════════════════════
# AI Flight Node Parameters
# ═══════════════════════════════════════════════════════════════════
ai_flight_node:
  ros__parameters:
    # Model settings
    model_path: "/home/pi/swarm-ros/model/UID_3.zip"  # Path to trained AI model
    device: "cpu"                       # Computation device (cpu/cuda)

    # Prediction settings
    prediction_rate: 10.0               # AI prediction rate (Hz)

    # QoS settings
    qos_depth: 1                        # QoS depth for AI topics

# ═══════════════════════════════════════════════════════════════════
# Safety Monitor Node Parameters - Simple Safety System
# ═══════════════════════════════════════════════════════════════════
safety_monitor_node:
  ros__parameters:
    # Attitude Limits
    max_roll_angle: 15.0                # Maximum roll angle (degrees)
    max_pitch_angle: 15.0               # Maximum pitch angle (degrees)

    # Altitude Limits
    min_altitude: 0.0                   # Minimum altitude (meters)
    max_altitude: 10.0                  # Maximum altitude (meters)

    # Geofencing
    max_distance_from_home: 50.0       # Maximum distance from home (meters)

    # Safety Action Timing
    hover_duration: 3.0                 # Hover duration before landing (seconds)

    # System Configuration
    monitor_rate: 20.0                  # Safety monitoring rate (Hz)
    qos_depth: 1                        # QoS depth for safety topics

# ═══════════════════════════════════════════════════════════════════
# FC Communications Node Parameters
# ═══════════════════════════════════════════════════════════════════
fc_comms_node:
  ros__parameters:
    # Serial communication
    serial_port: "/dev/ttyAMA0"         # Serial port for INAV communication
    baud_rate: 115200                   # Serial baud rate
    timeout: 1.0                        # Serial timeout (seconds)
    max_rx_buffer_size: 1024            # Maximum receive buffer size (bytes)

    # Connection management
    reconnect_interval: 5.0             # Reconnection attempt interval (seconds)
    telemetry_rate: 10.0                # Telemetry request rate (Hz)
    heartbeat_rate: 1.0                 # Heartbeat rate (Hz)
    heartbeat_timeout: 10.0             # Heartbeat timeout (seconds)
    connection_timeout: 10.0            # Overall connection timeout (seconds)

    # Waypoint polling
    waypoint_poll_mode: "first"         # Waypoint polling mode (first/all/none)
    max_waypoint_cycle: 10              # Maximum waypoint index to cycle through

    # Data processing scales
    imu_scale_accel: 0.01916015625      # IMU accelerometer scale factor (9.81/512.0)
    imu_scale_gyro: 0.001               # IMU gyroscope scale factor
    battery_voltage_scale: 10.0         # Battery voltage divisor (vbat / 10.0)
    battery_current_scale: 100.0        # Battery current divisor (amperage / 100.0)

    # QoS settings
    command_qos_depth: 10               # QoS depth for command topics

    # GPS altitude fallback
    gps_altitude_timeout: 5.0           # GPS altitude valid timeout (seconds)

# ═══════════════════════════════════════════════════════════════════
# FC Adapter Node Parameters
# ═══════════════════════════════════════════════════════════════════
fc_adapter_node:
  ros__parameters:
    # Control rate
    control_rate_hz: 40.0               # Main control loop rate (Hz)

    # Command timeout
    command_timeout: 1.0                # Command timeout before reverting to hover (seconds)

    # Startup sequence timing
    warmup_duration_sec: 10.0           # Total warmup before AI control (seconds)
    arming_duration_sec: 20.0           # Arming phase duration (seconds)
    rise_duration_sec: 5.0              # Rise phase duration (seconds)

    # RC channel settings
    rc_mid_value: 1500                  # RC channel center value (neutral)
    rc_min_value: 1450                  # RC minimum value (safety limit)
    rc_max_value: 1550                  # RC maximum value (safety limit)

    # Joystick mapping gains (RC units per m/s)
    # These control how much RC deflection per unit of velocity command
    vx_to_roll_gain: 50.0               # East/West gain (vx → roll channel)
    vy_to_pitch_gain: 50.0              # North/South gain (vy → pitch channel)
    vz_to_throttle_gain: 100.0          # Up/down gain (vz → throttle channel)

# ═══════════════════════════════════════════════════════════════════
# FC Adapter Node (CRUISE Direction Mode) Parameters
# ═══════════════════════════════════════════════════════════════════
fc_adapter_node_cruise:
  ros__parameters:
    # Control
    control_rate_hz: 40.0
    command_timeout: 1.0

    # RC authority (near full range)
    rc_mid_value: 1500
    rc_min_value: 1000
    rc_max_value: 2000
    rc_publish_rate_hz: 20.0

    # Startup sequence
    arming_duration_sec: 20.0
    rise_throttle_value: 1600
    rise_target_altitude_m: 3.0         # Requested initial rise altitude
    rise_max_duration_sec: 20.0
    post_rise_hover_sec: 1.0

    # CRUISE velocity mapping (cm/s)
    speed_limit_cms: 300.0
    nav_manual_speed_cms: 300.0
    nav_mc_manual_climb_rate_cms: 300.0

    # Direction command handling
    direction_norm_epsilon: 1.0e-6

    # Emergency landing
    landing_descent_throttle: 1450

# ═══════════════════════════════════════════════════════════════════
# Black Box Recorder Node Parameters
# ═══════════════════════════════════════════════════════════════════
black_box_recorder_node:
  ros__parameters:
    # Storage settings
    log_directory: "~/swarm-ros/flight-logs"  # Directory for log files (expands to home directory)
    max_log_file_size_mb: 100           # Maximum log file size (MB) before rotation

    # Logging behavior
    log_rate_hz: 10.0                   # Snapshot logging frequency (Hz) - default 10 Hz = 0.1s

    # QoS settings
    reliable_qos_depth: 10              # QoS depth for reliable data
    sensor_qos_depth: 1                 # QoS depth for sensor data

# ═══════════════════════════════════════════════════════════════════
# LiDAR Reader Node Parameters (Down Sensor)
# ═══════════════════════════════════════════════════════════════════
down_lidar/lidar_reader_down:
  ros__parameters:
    # I2C communication
    i2c_bus: 1                          # I2C bus number
    i2c_address: 0x08                   # I2C device address
    distance_register: 0x24             # Distance data register address

    # Sensor configuration
    frame_id: "down_lidar_link"         # TF frame for down sensor
    sensor_position: "down"             # Sensor mounting position
    publish_rate: 100.0                 # Publishing rate (Hz, max 100Hz per specs)

    # Range limits
    max_range: 50.0                     # Maximum valid range (meters)
    min_range: 0.05                     # Minimum valid range (meters)
    field_of_view: 0.035                # Sensor FOV (radians, ~2 degrees)

    # Data processing
    enable_filtering: true              # Enable distance filtering
    filter_window_size: 5               # Moving average window size
    max_invalid_readings: 10            # Max consecutive invalid readings before error

    # Timing
    status_publish_interval: 1.0        # Status publishing interval (seconds)
    reconnect_interval: 5.0             # I2C reconnection interval (seconds)

    # QoS settings
    sensor_qos_depth: 1                 # QoS depth for sensor data
    reliable_qos_depth: 10              # QoS depth for reliable data

    # Conversion
    mm_to_m_divisor: 1000.0             # Millimeter to meter conversion

# ═══════════════════════════════════════════════════════════════════
# LiDAR Reader Node Parameters (Front Sensor) - OPTIONAL
# ═══════════════════════════════════════════════════════════════════
#
# This front-facing LiDAR sensor configuration is optional and it hasn't been tested in the current swarm setup.
# To enable it, uncomment the section below and ensure the hardware is properly connected and configured.
#
# Uncomment to enable front-facing LiDAR sensor
# front_lidar/lidar_reader_front:
#   ros__parameters:
#     # I2C communication
#     i2c_bus: 1                          # I2C bus number
#     i2c_address: 0x08                   # I2C device address (different from down)
#     distance_register: 0x24             # Distance data register address
#
#     # Sensor configuration
#     frame_id: "front_lidar_link"        # TF frame for front sensor
#     sensor_position: "front"            # Sensor mounting position
#     publish_rate: 100.0                 # Publishing rate (Hz, max 100Hz per specs)
#
#     # Range limits
#     max_range: 50.0                     # Maximum valid range (meters)
#     min_range: 0.05                     # Minimum valid range (meters)
#     field_of_view: 0.035                # Sensor FOV (radians, ~2 degrees)
#
#     # Data processing
#     enable_filtering: true              # Enable distance filtering
#     filter_window_size: 5               # Moving average window size
#     max_invalid_readings: 10            # Max consecutive invalid readings before error
#
#     # Timing
#     status_publish_interval: 1.0        # Status publishing interval (seconds)
#     reconnect_interval: 5.0             # I2C reconnection interval (seconds)
#
#     # QoS settings
#     sensor_qos_depth: 1                 # QoS depth for sensor data
#     reliable_qos_depth: 10              # QoS depth for reliable data
#
#     # Conversion
#     mm_to_m_divisor: 1000.0             # Millimeter to meter conversion
