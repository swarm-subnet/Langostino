# Swarm AI Integration Parameters Configuration
# Complete parameter set for all nodes in the swarm system

# ═══════════════════════════════════════════════════════════════════
# AI Adapter Node Parameters
# ═══════════════════════════════════════════════════════════════════
ai_adapter_node:
  ros__parameters:
    # Observation generation
    telemetry_rate: 30.0                # Observation generation rate (Hz)
    max_ray_distance: 20.0              # Maximum distance for normalization (meters) - MUST MATCH TRAINING
    action_buffer_size: 25              # Number of past actions to buffer

    # Initial position
    relative_start_enu: [0.0, 0.0, 3.0] # Initial relative position [East, North, Up] (meters)

    # GPS settings
    min_gps_satellites: 6                # Minimum GPS satellites for valid fix

    # QoS settings
    sensor_qos_depth: 1                 # QoS depth for sensor topics
    reliable_qos_depth: 10              # QoS depth for reliable topics

    # Debug settings
    debug_mode: false                   # Enable debug output
    publish_debug_info: false            # Publish debug topics

# ═══════════════════════════════════════════════════════════════════
# AI Flight Node Parameters
# ═══════════════════════════════════════════════════════════════════
ai_flight_node:
  ros__parameters:
    # Model settings
    model_path: "/home/pi/swarm-ros/model/UID_3.zip"  # Path to trained AI model
    device: "cpu"                       # Computation device (cpu/cuda)

    # Prediction settings
    prediction_rate: 10.0               # AI prediction rate (Hz)

    # QoS settings
    qos_depth: 1                        # QoS depth for AI topics

# ═══════════════════════════════════════════════════════════════════
# Safety Monitor Node Parameters - Simple Safety System
# ═══════════════════════════════════════════════════════════════════
safety_monitor_node:
  ros__parameters:
    # Attitude Limits
    max_roll_angle: 15.0                # Maximum roll angle (degrees)
    max_pitch_angle: 15.0               # Maximum pitch angle (degrees)

    # Altitude Limits
    min_altitude: 0.0                   # Minimum altitude (meters)
    max_altitude: 10.0                  # Maximum altitude (meters)

    # Geofencing
    max_distance_from_home: 50.0       # Maximum distance from home (meters)

    # Safety Action Timing
    hover_duration: 3.0                 # Hover duration before landing (seconds)

    # System Configuration
    monitor_rate: 20.0                  # Safety monitoring rate (Hz)
    qos_depth: 1                        # QoS depth for safety topics

# ═══════════════════════════════════════════════════════════════════
# FC Communications Node Parameters
# ═══════════════════════════════════════════════════════════════════
fc_comms_node:
  ros__parameters:
    # Serial communication
    serial_port: "/dev/ttyAMA0"         # Serial port for INAV communication
    baud_rate: 115200                   # Serial baud rate
    timeout: 1.0                        # Serial timeout (seconds)
    max_rx_buffer_size: 1024            # Maximum receive buffer size (bytes)

    # Connection management
    reconnect_interval: 5.0             # Reconnection attempt interval (seconds)
    telemetry_rate: 10.0                # Telemetry request rate (Hz)
    heartbeat_rate: 1.0                 # Heartbeat rate (Hz)
    heartbeat_timeout: 10.0             # Heartbeat timeout (seconds)
    connection_timeout: 10.0            # Overall connection timeout (seconds)

    # Waypoint polling
    waypoint_poll_mode: "first"         # Waypoint polling mode (first/all/none)
    max_waypoint_cycle: 10              # Maximum waypoint index to cycle through

    # Data processing scales
    imu_scale_accel: 0.01916015625      # IMU accelerometer scale factor (9.81/512.0)
    imu_scale_gyro: 0.001               # IMU gyroscope scale factor
    battery_voltage_scale: 10.0         # Battery voltage divisor (vbat / 10.0)
    battery_current_scale: 100.0        # Battery current divisor (amperage / 100.0)

    # QoS settings
    command_qos_depth: 10               # QoS depth for command topics

# ═══════════════════════════════════════════════════════════════════
# FC Adapter Node Parameters
# ═══════════════════════════════════════════════════════════════════
fc_adapter_node:
  ros__parameters:
    # Control rates
    control_rate_hz: 40.0               # Main control loop rate (Hz)
    prearm_rate_hz: 40                  # Pre-arm sequence rate (Hz)

    # Velocity limits
    max_velocity: 0.1                   # Maximum velocity command (m/s)

    # Command processing
    command_timeout: 1.0                # Command timeout (seconds)

    # Timing
    warmup_frames: 40                   # Number of warmup frames before accepting commands
    startup_delay_sec: 20.0             # Initial startup delay (seconds)
    prearm_duration_sec: 30.0           # Pre-arm sequence duration (seconds)

    # Pre-arm configuration
    prearm_enabled: true                # Enable pre-arm sequence
    arm_aux_high: true                  # Set AUX channel high during arm
    enable_angle_mode: true             # Enable angle mode
    enable_althold_mode: true           # Enable altitude hold mode
    enable_nav_rth: false               # Enable NAV RTH on CH9

    # MSP Serial settings
    msp_serial_port: "/dev/ttyAMA0"     # MSP serial port
    msp_baud_rate: 115200               # MSP baud rate
    msp_write_timeout: 0.05             # MSP write timeout (seconds)

    # RC channel settings
    rc_mid_value: 1500                  # RC channel center value
    rc_min_value: 1450                  # RC minimum value (safety limit)
    rc_max_value: 1550                  # RC maximum value (safety limit)
    rc_deviation_limit: 150.0           # Maximum RC deviation from center

    # Yaw control
    enable_yaw_control: false           # Enable dynamic yaw alignment (false = fixed yaw like training)
    yaw_kp: 200.0                       # Proportional gain for yaw control (only used if enable_yaw_control = true)
    yaw_rate_limit: 300.0               # Maximum yaw rate change (deg/s, only used if enable_yaw_control = true)

    # PID Controller gains
    kp_xy: 150.0                        # Proportional gain for XY control
    ki_xy: 10.0                         # Integral gain for XY control
    kd_xy: 20.0                         # Derivative gain for XY control
    kp_z: 100.0                         # Proportional gain for Z control (not used - keeping for compatibility)
    ki_z: 5.0                           # Integral gain for Z control (not used)
    kd_z: 15.0                          # Derivative gain for Z control (not used)

    # PID limits
    pid_output_min: -400.0              # Minimum PID output
    pid_output_max: 400.0               # Maximum PID output
    pid_integral_max: 50.0              # Maximum integral accumulation
    pid_derivative_filter_alpha: 0.1    # Derivative filter coefficient (0-1)
    pid_max_history_length: 100         # Maximum PID history length

    # Z-axis direct control (no PID)
    vz_to_throttle_scale: 100.0         # vz (m/s) to throttle RC units conversion
    throttle_rate_limit: 200.0          # Maximum throttle change rate (units/s)

# ═══════════════════════════════════════════════════════════════════
# Black Box Recorder Node Parameters
# ═══════════════════════════════════════════════════════════════════
black_box_recorder_node:
  ros__parameters:
    # Storage settings
    log_directory: "~/swarm-ros/flight-logs"  # Directory for log files (expands to home directory)
    max_log_file_size_mb: 100           # Maximum log file size (MB) before rotation

    # Logging behavior
    log_rate_hz: 10.0                   # Snapshot logging frequency (Hz) - default 10 Hz = 0.1s

    # QoS settings
    reliable_qos_depth: 10              # QoS depth for reliable data
    sensor_qos_depth: 1                 # QoS depth for sensor data

# ═══════════════════════════════════════════════════════════════════
# LiDAR Reader Node Parameters (Down Sensor)
# ═══════════════════════════════════════════════════════════════════
down_lidar/lidar_reader_down:
  ros__parameters:
    # I2C communication
    i2c_bus: 1                          # I2C bus number
    i2c_address: 0x08                   # I2C device address
    distance_register: 0x24             # Distance data register address

    # Sensor configuration
    frame_id: "down_lidar_link"         # TF frame for down sensor
    sensor_position: "down"             # Sensor mounting position
    publish_rate: 100.0                 # Publishing rate (Hz, max 100Hz per specs)

    # Range limits
    max_range: 50.0                     # Maximum valid range (meters)
    min_range: 0.05                     # Minimum valid range (meters)
    field_of_view: 0.035                # Sensor FOV (radians, ~2 degrees)

    # Data processing
    enable_filtering: true              # Enable distance filtering
    filter_window_size: 5               # Moving average window size
    max_invalid_readings: 10            # Max consecutive invalid readings before error

    # Timing
    status_publish_interval: 1.0        # Status publishing interval (seconds)
    reconnect_interval: 5.0             # I2C reconnection interval (seconds)

    # QoS settings
    sensor_qos_depth: 1                 # QoS depth for sensor data
    reliable_qos_depth: 10              # QoS depth for reliable data

    # Conversion
    mm_to_m_divisor: 1000.0             # Millimeter to meter conversion

# ═══════════════════════════════════════════════════════════════════
# LiDAR Reader Node Parameters (Front Sensor) - OPTIONAL
# ═══════════════════════════════════════════════════════════════════
# Uncomment to enable front-facing LiDAR sensor
# front_lidar/lidar_reader_front:
#   ros__parameters:
#     # I2C communication
#     i2c_bus: 1                          # I2C bus number
#     i2c_address: 0x08                   # I2C device address (different from down)
#     distance_register: 0x24             # Distance data register address
#
#     # Sensor configuration
#     frame_id: "front_lidar_link"        # TF frame for front sensor
#     sensor_position: "front"            # Sensor mounting position
#     publish_rate: 100.0                 # Publishing rate (Hz, max 100Hz per specs)
#
#     # Range limits
#     max_range: 50.0                     # Maximum valid range (meters)
#     min_range: 0.05                     # Minimum valid range (meters)
#     field_of_view: 0.035                # Sensor FOV (radians, ~2 degrees)
#
#     # Data processing
#     enable_filtering: true              # Enable distance filtering
#     filter_window_size: 5               # Moving average window size
#     max_invalid_readings: 10            # Max consecutive invalid readings before error
#
#     # Timing
#     status_publish_interval: 1.0        # Status publishing interval (seconds)
#     reconnect_interval: 5.0             # I2C reconnection interval (seconds)
#
#     # QoS settings
#     sensor_qos_depth: 1                 # QoS depth for sensor data
#     reliable_qos_depth: 10              # QoS depth for reliable data
#
#     # Conversion
#     mm_to_m_divisor: 1000.0             # Millimeter to meter conversion
